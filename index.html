<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#101418">
    <link rel="manifest" href="manifest.json">
    <title>VANTAGE // Sistema de Intelig√™ncia</title>
    <link rel="stylesheet" href="style.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Roboto+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>

<body>
    <canvas id="network-canvas"></canvas>

    <div class="interface-layer">
        <header>
            <div class="brand">
                <div class="logo-mark"></div>
                <span>VANTAGE</span>
            </div>
            <nav>
                <a href="#" class="nav-link active" data-view="dashboard">DASHBOARD</a>
                <a href="#" class="nav-link" data-view="entities">ENTIDADES</a>
                <a href="#" class="nav-link" data-view="timeline">üìÖ TIMELINE</a>
                <a href="#" class="nav-link" data-view="ingest">INGEST√ÉO</a>
                <a href="#" class="nav-link" data-view="research">PESQUISAR</a>
                <a href="#" class="nav-link" data-view="investigate">üïµÔ∏è DOSSI√ä</a>
                <a href="#" class="nav-link" data-view="chat">üí¨ CHAT</a>
                <a href="#" class="nav-link" data-view="map">MAPA</a>
                <a href="#" class="nav-link" data-view="network">REDE</a>
            </nav>
            <div class="header-right">
                <div class="project-selector">
                    <select id="project-select" onchange="switchProject(this.value)">
                        <option value="">üìÇ Todos os Projetos</option>
                    </select>
                    <button class="btn-icon" onclick="openProjectModal()" title="Gerenciar Projetos">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                    </button>
                </div>
                <div class="api-status">
                    <span class="status-dot"></span>
                    <span id="api-status-text">Conectando...</span>
                </div>
            </div>
        </header>

        <!-- Dashboard View -->
        <main id="dashboard-view" class="view active">
            <section class="hero">
                <div class="hero-content">
                    <p class="mono-label">SISTEMA OPERACIONAL CENTRAL</p>
                    <h1>Intelig√™ncia Decisiva em Escala Global.</h1>
                    <p class="hero-desc">Integre dados, decis√µes e opera√ß√µes em uma √∫nica estrutura unificada.</p>
                </div>
            </section>

            <section class="metrics-grid">
                <div class="metric-card">
                    <div class="card-header">
                        <span class="icon">‚¶ø</span>
                        <span class="card-title">ENTIDADES</span>
                    </div>
                    <div class="card-body">
                        <h3 id="stat-entities">--</h3>
                        <p>Total no Sistema</p>
                        <div class="data-vis-bar">
                            <div class="fill" id="fill-entities"></div>
                        </div>
                    </div>
                </div>
                <div class="metric-card">
                    <div class="card-header">
                        <span class="icon">‚ú£</span>
                        <span class="card-title">CONEX√ïES</span>
                    </div>
                    <div class="card-body">
                        <h3 id="stat-relationships">--</h3>
                        <p>Relacionamentos Mapeados</p>
                        <div class="data-vis-bar">
                            <div class="fill" id="fill-relationships"></div>
                        </div>
                    </div>
                </div>
                <div class="metric-card">
                    <div class="card-header">
                        <span class="icon">‚óà</span>
                        <span class="card-title">EVENTOS</span>
                    </div>
                    <div class="card-body">
                        <h3 id="stat-events">--</h3>
                        <p>Ocorr√™ncias Registradas</p>
                        <div class="data-vis-bar">
                            <div class="fill" id="fill-events"></div>
                        </div>
                    </div>
                </div>
                <div class="metric-card">
                    <div class="card-header">
                        <span class="icon">üìÑ</span>
                        <span class="card-title">DOCUMENTOS</span>
                    </div>
                    <div class="card-body">
                        <h3 id="stat-documents">--</h3>
                        <p>Arquivos Indexados</p>
                        <div class="data-vis-bar">
                            <div class="fill" id="fill-documents"></div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="recent-activity">
                <h2 class="section-title">Atividade Recente</h2>
                <div id="activity-list" class="activity-list">
                    <p class="loading-text">Carregando...</p>
                </div>
            </section>
        </main>

        <!-- Entities View -->
        <main id="entities-view" class="view">
            <section class="view-header">
                <h1>Entidades</h1>
                <div class="header-actions">
                    <button class="btn-secondary" onclick="showMergeModal()">üîó MESCLAR DUPLICATAS</button>
                    <button class="btn-primary" onclick="showAddEntityModal()">+ NOVA ENTIDADE</button>
                </div>
            </section>

            <div class="filter-bar">
                <select id="entity-type-filter" onchange="loadEntities()">
                    <option value="">Todos os Tipos</option>
                    <option value="person">Pessoas</option>
                    <option value="organization">Organiza√ß√µes</option>
                    <option value="location">Locais</option>
                    <option value="event">Eventos</option>
                </select>
                <input type="text" id="entity-search" placeholder="Buscar entidades..." onkeyup="debounceSearch()">
            </div>

            <div id="entities-list" class="entities-grid">
                <p class="loading-text">Carregando entidades...</p>
            </div>
        </main>

        <!-- Ingest View -->
        <main id="ingest-view" class="view">
            <section class="view-header">
                <h1>Ingest√£o de Dados</h1>
            </section>

            <div class="ingest-tabs">
                <button class="tab-btn active" onclick="switchIngestTab('wikipedia')">Wikipedia</button>
                <button class="tab-btn" onclick="switchIngestTab('news')">Not√≠cias</button>
                <button class="tab-btn" onclick="switchIngestTab('manual')">Manual</button>
                <button class="tab-btn" onclick="switchIngestTab('analyze')">üß† An√°lise IA</button>
            </div>

            <!-- Wikipedia Tab -->
            <div id="ingest-wikipedia" class="ingest-panel active">
                <div class="search-box">
                    <input type="text" id="wiki-search" placeholder="Buscar na Wikipedia...">
                    <button class="btn-primary" onclick="searchWikipedia()">BUSCAR</button>
                </div>
                <div id="wiki-results" class="results-list"></div>
            </div>

            <!-- News Tab -->
            <div id="ingest-news" class="ingest-panel">
                <div class="search-box">
                    <input type="text" id="news-search" placeholder="Buscar not√≠cias...">
                    <button class="btn-primary" onclick="searchNews()">BUSCAR</button>
                </div>
                <div class="news-feeds">
                    <h3>Feeds Dispon√≠veis</h3>
                    <div id="news-feeds-list" class="feeds-grid"></div>
                </div>
                <div id="news-results" class="results-list"></div>
            </div>

            <!-- Manual Tab -->
            <div id="ingest-manual" class="ingest-panel">
                <form id="manual-entity-form" onsubmit="createManualEntity(event)">
                    <div class="form-group">
                        <label>Tipo</label>
                        <select id="manual-type" required>
                            <option value="person">Pessoa</option>
                            <option value="organization">Organiza√ß√£o</option>
                            <option value="location">Local</option>
                            <option value="event">Evento</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Nome</label>
                        <input type="text" id="manual-name" required placeholder="Nome da entidade">
                    </div>
                    <div class="form-group">
                        <label>Descri√ß√£o</label>
                        <textarea id="manual-desc" rows="4" placeholder="Descri√ß√£o detalhada..."></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Latitude (opcional)</label>
                            <input type="number" id="manual-lat" step="any" placeholder="-23.5505">
                        </div>
                        <div class="form-group">
                            <label>Longitude (opcional)</label>
                            <input type="number" id="manual-lng" step="any" placeholder="-46.6333">
                        </div>
                    </div>
                    <button type="submit" class="btn-primary">CRIAR ENTIDADE</button>
                </form>
            </div>

            <!-- AI Analysis Tab -->
            <div id="ingest-analyze" class="ingest-panel">
                <div class="analyze-intro">
                    <p>üß† <strong>An√°lise Inteligente com IA</strong> - Cole qualquer texto (not√≠cia, documento, artigo)
                        e o sistema ir√° extrair automaticamente entidades, relacionamentos e eventos usando IA avan√ßada.
                    </p>
                </div>
                <div class="form-group">
                    <label>Texto para An√°lise</label>
                    <textarea id="analyze-text" rows="8"
                        placeholder="Cole aqui o texto que deseja analisar..."></textarea>
                </div>
                <div class="analyze-options">
                    <label class="checkbox-label">
                        <input type="checkbox" id="analyze-auto-create" checked>
                        Criar automaticamente entidades encontradas no banco de dados
                    </label>
                </div>
                <button class="btn-primary" onclick="analyzeText()">üîç ANALISAR TEXTO</button>
                <div id="analyze-results" class="analyze-results"></div>
            </div>
        </main>

        <!-- Search View -->
        <main id="search-view" class="view">
            <section class="view-header">
                <h1>Busca Global</h1>
            </section>

            <div class="search-box large">
                <input type="text" id="global-search" placeholder="Buscar em todo o sistema...">
                <button class="btn-primary" onclick="globalSearch()">BUSCAR</button>
            </div>

            <div id="search-results" class="search-results">
                <p class="hint-text">Digite algo para buscar em entidades, eventos e documentos.</p>
            </div>
        </main>

        <!-- Map View -->
        <main id="map-view" class="view">
            <section class="view-header">
                <h1>Mapa Global</h1>
                <div class="map-filters">
                    <select id="map-type-filter" onchange="loadMapData()">
                        <option value="">Todos os Tipos</option>
                        <option value="person">Pessoas</option>
                        <option value="organization">Organiza√ß√µes</option>
                        <option value="location">Locais</option>
                    </select>
                </div>
            </section>
            <div id="map-container"></div>
            <div id="map-info" class="map-info-panel">
                <p class="hint-text">Clique em um marcador para ver detalhes</p>
            </div>
        </main>

        <!-- Research View -->
        <main id="research-view" class="view">
            <section class="view-header">
                <h1>üîç Deep Research</h1>
                <p class="subtitle">Pesquisa avan√ßada com IA e extra√ß√£o autom√°tica de entidades</p>
            </section>

            <div class="research-container">
                <div class="research-input-section">
                    <div class="research-search-box">
                        <input type="text" id="research-query"
                            placeholder="Digite sua pesquisa... (ex: Elon Musk neg√≥cios 2024)">
                        <select id="research-mode">
                            <option value="search">üîé Busca R√°pida</option>
                            <option value="deep">üß† Deep Research</option>
                            <option value="heavy">üìö Busca Completa</option>
                        </select>
                        <button class="btn-primary" onclick="executeResearch()">PESQUISAR</button>
                    </div>
                    <div class="research-options">
                        <label>
                            <input type="checkbox" id="research-auto-extract" checked>
                            Extrair entidades automaticamente
                        </label>
                    </div>
                </div>

                <div id="research-loading" class="research-loading" style="display: none;">
                    <div class="loading-spinner"></div>
                    <p>üß† Analisando com IA... isso pode demorar alguns segundos</p>
                </div>

                <div id="research-results" class="research-results"></div>
            </div>
        </main>

        <!-- Investigation View -->
        <main id="investigate-view" class="view">
            <section class="view-header">
                <h1>üïµÔ∏è Dossi√™ de Investiga√ß√£o</h1>
                <p class="subtitle">Gera√ß√£o autom√°tica de dossi√™s com dados p√∫blicos + web search + NER</p>
            </section>

            <div class="investigate-container">
                <div class="investigate-tabs">
                    <button class="inv-tab active" onclick="switchInvTab('company')">üè¢ Empresa (CNPJ)</button>
                    <button class="inv-tab" onclick="switchInvTab('person')">üë§ Pessoa</button>
                </div>

                <div id="inv-company" class="inv-panel active">
                    <div class="inv-input-group">
                        <label>CNPJ da Empresa</label>
                        <input type="text" id="inv-cnpj" placeholder="00.000.000/0000-00">
                        <button class="btn-primary" onclick="investigateCompany()">INVESTIGAR</button>
                    </div>
                </div>

                <div id="inv-person" class="inv-panel">
                    <div class="inv-input-group">
                        <label>Nome Completo</label>
                        <input type="text" id="inv-nome" placeholder="Nome da pessoa">
                    </div>
                    <div class="inv-input-group">
                        <label>CPF (opcional)</label>
                        <input type="text" id="inv-cpf" placeholder="000.000.000-00">
                        <button class="btn-primary" onclick="investigatePerson()">INVESTIGAR</button>
                    </div>
                </div>

                <div id="inv-loading" class="inv-loading" style="display: none;">
                    <div class="loading-spinner"></div>
                    <p>üîç Coletando dados de m√∫ltiplas fontes... isso pode levar alguns segundos</p>
                </div>

                <div id="inv-result" class="inv-result"></div>
            </div>
        </main>

        <!-- Timeline View -->
        <main id="timeline-view" class="view">
            <section class="view-header">
                <h1>üìÖ Timeline</h1>
                <p class="subtitle">Visualiza√ß√£o temporal de entidades e conex√µes</p>
            </section>

            <div class="timeline-controls">
                <div class="timeline-filters">
                    <select id="timeline-days" onchange="loadTimeline()">
                        <option value="7">√öltimos 7 dias</option>
                        <option value="30" selected>√öltimos 30 dias</option>
                        <option value="90">√öltimos 90 dias</option>
                        <option value="365">√öltimo ano</option>
                    </select>
                    <select id="timeline-type" onchange="loadTimeline()">
                        <option value="">Todos os tipos</option>
                        <option value="person">üë§ Pessoas</option>
                        <option value="organization">üè¢ Organiza√ß√µes</option>
                        <option value="location">üìç Locais</option>
                        <option value="event">üìÖ Eventos</option>
                    </select>
                </div>
                <div class="timeline-stats">
                    <span id="timeline-total">0 eventos</span>
                </div>
            </div>

            <div id="timeline-container" class="timeline-container">
                <div class="timeline-loading">
                    <div class="loading-spinner"></div>
                    <p>Carregando timeline...</p>
                </div>
            </div>
        </main>

        <!-- Chat View -->
        <main id="chat-view" class="view">
            <section class="view-header">
                <h1>üí¨ AVANGARD Chat</h1>
                <p class="subtitle">Assistente inteligente com acesso ao grafo de conhecimento</p>
            </section>

            <div class="chat-container">
                <div id="chat-messages" class="chat-messages">
                    <div class="chat-message assistant">
                        <div class="message-avatar">üõ°Ô∏è</div>
                        <div class="message-content">
                            <p>Ol√°! Sou o AVANGARD, seu assistente de intelig√™ncia.</p>
                            <p>Posso responder perguntas usando o conhecimento do NUMIDIUM e pesquisar na web quando
                                necess√°rio.</p>
                            <p>Como posso ajudar?</p>
                        </div>
                    </div>
                </div>

                <div class="chat-input-area">
                    <div class="chat-options">
                        <label>
                            <input type="checkbox" id="chat-use-web" checked>
                            üåê Incluir pesquisa web
                        </label>
                        <button class="btn-text" onclick="clearChatHistory()">üóëÔ∏è Limpar hist√≥rico</button>
                    </div>
                    <div class="chat-input-box">
                        <input type="text" id="chat-input" placeholder="Digite sua pergunta..."
                            onkeypress="if(event.key==='Enter') sendChatMessage()">
                        <button class="btn-primary" onclick="sendChatMessage()">Enviar</button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Network View -->
        <main id="network-view" class="view">
            <section class="view-header">
                <h1>Rede de Conex√µes</h1>
                <div class="network-controls">
                    <select id="network-type-filter" onchange="loadNetworkGraph()">
                        <option value="">Todos os Tipos</option>
                        <option value="person">Pessoas</option>
                        <option value="organization">Organiza√ß√µes</option>
                        <option value="location">Locais</option>
                    </select>
                    <select id="network-layout" onchange="changeNetworkLayout()">
                        <option value="cose">Layout Org√¢nico</option>
                        <option value="circle">C√≠rculo</option>
                        <option value="grid">Grade</option>
                        <option value="breadthfirst">Hier√°rquico</option>
                    </select>
                    <button class="btn-secondary" onclick="showAddRelationshipModal()">üîó + CONEX√ÉO</button>
                    <button class="btn-primary" onclick="loadNetworkGraph()">üîÑ RECARREGAR</button>
                </div>
            </section>
            <div id="cy-container"></div>
            <div id="network-info" class="network-info-panel">
                <div class="network-stats">
                    <span id="network-node-count">0 n√≥s</span>
                    <span id="network-edge-count">0 conex√µes</span>
                </div>
                <div id="network-selected" class="network-selected">
                    <p class="hint-text">Clique em um n√≥ para ver detalhes</p>
                </div>
            </div>
        </main>

        <!-- Entity Detail Modal -->
        <div id="entity-modal" class="modal">
            <div class="modal-content">
                <button class="modal-close" onclick="closeModal()">&times;</button>
                <div id="entity-modal-body"></div>
            </div>
        </div>

        <!-- Merge Modal -->
        <div id="merge-modal" class="modal">
            <div class="modal-content modal-large">
                <button class="modal-close" onclick="closeMergeModal()">&times;</button>
                <div class="merge-modal-body">
                    <h2>üîó Mesclar Entidades Duplicadas</h2>

                    <div class="merge-suggestions">
                        <h3>Sugest√µes da IA</h3>
                        <button class="btn-secondary" onclick="loadMergeSuggestions()">üß† Buscar Duplicatas</button>
                        <div id="merge-suggestions-list" class="merge-suggestions-list">
                            <p class="hint-text">Clique no bot√£o para a IA analisar entidades duplicadas</p>
                        </div>
                    </div>

                    <div class="merge-manual">
                        <h3>Merge Manual</h3>
                        <div class="merge-selectors">
                            <div class="merge-select-group">
                                <label>Entidade Principal (ser√° mantida)</label>
                                <select id="merge-primary" onchange="updateMergePreview()">
                                    <option value="">Selecione...</option>
                                </select>
                            </div>
                            <div class="merge-arrow">‚Üí</div>
                            <div class="merge-select-group">
                                <label>Entidade Secund√°ria (ser√° mesclada)</label>
                                <select id="merge-secondary" onchange="updateMergePreview()">
                                    <option value="">Selecione...</option>
                                </select>
                            </div>
                        </div>
                        <div id="merge-preview" class="merge-preview"></div>
                        <button id="merge-btn" class="btn-primary" onclick="executeMerge()" disabled>MESCLAR
                            ENTIDADES</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Relationship Modal -->
        <div id="relationship-modal" class="modal">
            <div class="modal-content">
                <button class="modal-close" onclick="closeRelationshipModal()">&times;</button>
                <div class="relationship-modal-body">
                    <h2>üîó Nova Conex√£o</h2>
                    <div class="relationship-form">
                        <div class="form-group">
                            <label>Entidade Origem</label>
                            <select id="rel-source">
                                <option value="">Selecione...</option>
                            </select>
                        </div>
                        <div class="relationship-type-input">
                            <label>Tipo de Rela√ß√£o</label>
                            <input type="text" id="rel-type" placeholder="ex: trabalha em, conhece, fundou...">
                            <div class="type-suggestions">
                                <span onclick="setRelType('trabalha em')">trabalha em</span>
                                <span onclick="setRelType('conhece')">conhece</span>
                                <span onclick="setRelType('fundou')">fundou</span>
                                <span onclick="setRelType('casado com')">casado com</span>
                                <span onclick="setRelType('localizado em')">localizado em</span>
                                <span onclick="setRelType('membro de')">membro de</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Entidade Destino</label>
                            <select id="rel-target">
                                <option value="">Selecione...</option>
                            </select>
                        </div>
                        <button class="btn-primary" onclick="createRelationship()">CRIAR CONEX√ÉO</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Project Modal -->
        <div id="project-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üìÇ Gerenciar Projetos</h2>
                    <button class="modal-close" onclick="closeProjectModal()">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="project-form">
                        <input type="text" id="new-project-name" placeholder="Nome do novo projeto">
                        <input type="color" id="new-project-color" value="#00d4ff">
                        <button onclick="createProject()">Criar Projeto</button>
                    </div>
                    <div id="project-list" class="project-list">
                        <!-- Projects will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <div class="status-bar">
                <span>NUMIDIUM: <span class="status-ok" id="footer-status">CONECTANDO</span></span>
                <span class="mono-label">V.1.0.0-BETA</span>
            </div>
        </footer>
    </div>
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- Cytoscape.js for network graphs -->
    <script src="https://unpkg.com/cytoscape@3.28.1/dist/cytoscape.min.js"></script>
    <script src="script.js"></script>
</body>

</html>